import{bE as z,bF as e,bG as St,bH as Ae,bI as yt,bJ as Ct,r as l,bK as Oe,bL as vt,bM as bt,bN as jt,bO as Tt,bP as wt,bQ as kt,bR as Nt,bS as Lt,bT as At,bU as It,bV as Pt,bW as Ie,bX as Et}from"./vendor-3b0eb66e.js";import{D as Be,S as C,I as Pe,P as Rt,T as pe,a as Mt,B as fe,b as Gt,c as ue,d as Ue,C as qt,e as Ee,L as Ot,f as Bt,g as Ut,h as Re,i as $t,j as Ft,k as Vt,l as M,m as Ht,n as Dt,o as Qt}from"./fluentui-react-cc049b91.js";import{e as zt,E as Kt,f as Wt,g as Jt,D as Xt,h as Yt}from"./fluentui-icons-cc979dd7.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const r of u.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function c(a){if(a.ep)return;a.ep=!0;const u=n(a);fetch(a.href,u)}})();const Zt=".auth/me",es=".auth/refresh",ts=".auth/logout?post_logout_redirect_uri=/";async function ss(){const t=await fetch("/auth_setup");if(!t.ok)throw new Error(`auth setup response was not ok: ${t.status}`);return await t.json()}const U=await ss(),P=U.useLogin,Q=U.requireAccessControl,ns=U.msalConfig,as=U.loginRequest,os=U.tokenRequest,$e=()=>window.location.origin+U.msalConfig.auth.redirectUri,rs=()=>fetch(es).then(t=>t.ok?fetch(Zt).then(s=>s.ok?s.json().then(n=>n.length>0?{id_token:n[0].id_token,access_token:n[0].access_token,user_claims:n[0].user_claims.reduce((c,a)=>(c[a.typ]=a.val,c),{})}:null):null):null),G=await rs(),is=()=>{window.location.href=ts},me=t=>t?.getActiveAccount()!=null||G!=null,ge=t=>G?Promise.resolve(G.access_token):t.acquireTokenSilent({...os,redirectUri:$e()}).then(s=>s.accessToken).catch(s=>{console.log(s)});const cs="/assets/github-fab00c2d.svg",ls="_layout_1nrkm_1",us="_header_1nrkm_7",ds="_headerContainer_1nrkm_12",hs="_headerTitleContainer_1nrkm_20",ps="_headerLogo_1nrkm_28",ms="_headerTitle_1nrkm_20",gs="_headerNavList_1nrkm_37",xs="_headerNavPageLink_1nrkm_43",_s="_headerNavPageLinkActive_1nrkm_57",fs="_headerNavLeftMargin_1nrkm_62",Ss="_headerRightText_1nrkm_66",ys="_microsoftLogo_1nrkm_71",Cs="_githubLogo_1nrkm_76",v={layout:ls,header:us,headerContainer:ds,headerTitleContainer:hs,headerLogo:ps,headerTitle:ms,headerNavList:gs,headerNavPageLink:xs,headerNavPageLinkActive:_s,headerNavLeftMargin:fs,headerRightText:Ss,microsoftLogo:ys,githubLogo:Cs},vs="_loginButton_m8yze_1",bs={loginButton:vs},js=()=>{const{instance:t}=z(),s=t.getActiveAccount(),n=(s||G)!=null,c=()=>{t.loginPopup({...as,redirectUri:$e()}).catch(r=>console.log(r))},a=()=>{s?t.logoutPopup({mainWindowRedirectUri:"/",account:t.getActiveAccount()}).catch(r=>console.log(r)):is()},u=`Logout
${s?.username??G?.user_claims?.preferred_username}`;return e.jsx(Be,{text:n?u:"Login",className:bs.loginButton,onClick:n?a:c})},Me=()=>e.jsxs("div",{className:v.layout,children:[e.jsx("header",{className:v.header,role:"banner",children:e.jsxs("div",{className:v.headerContainer,children:[e.jsx(St,{to:"/",className:v.headerTitleContainer,children:e.jsx("h3",{className:v.headerTitle,children:"GPT + Enterprise data | Sample"})}),e.jsx("nav",{children:e.jsxs("ul",{className:v.headerNavList,children:[e.jsx("li",{children:e.jsx(Ae,{to:"/",className:({isActive:t})=>t?v.headerNavPageLinkActive:v.headerNavPageLink,children:"Chat"})}),e.jsx("li",{className:v.headerNavLeftMargin,children:e.jsx(Ae,{to:"/qa",className:({isActive:t})=>t?v.headerNavPageLinkActive:v.headerNavPageLink,children:"Ask a question"})}),e.jsx("li",{className:v.headerNavLeftMargin,children:e.jsx("a",{href:"https://aka.ms/entgptsearch",target:"_blank",title:"Github repository link",children:e.jsx("img",{src:cs,alt:"Github logo","aria-label":"Link to github repository",width:"20px",height:"20px",className:v.githubLogo})})})]})}),e.jsx("h4",{className:v.headerRightText,children:"Azure OpenAI + AI Search"}),P&&e.jsx(js,{})]})}),e.jsx(yt,{})]}),Ts="_container_18ti9_1",ws="_chatRoot_18ti9_8",ks="_chatContainer_18ti9_13",Ns="_chatEmptyState_18ti9_21",Ls="_chatEmptyStateTitle_18ti9_31",As="_chatEmptyStateSubtitle_18ti9_38",Is="_chatMessageStream_18ti9_54",Ps="_chatMessageGpt_18ti9_66",Es="_chatMessageGptMinWidth_18ti9_73",Rs="_chatInput_18ti9_78",Ms="_chatAnalysisPanel_18ti9_91",Gs="_chatSettingsSeparator_18ti9_99",qs="_loadingLogo_18ti9_103",Os="_commandsContainer_18ti9_107",Bs="_commandButton_18ti9_112",p={container:Ts,chatRoot:ws,chatContainer:ks,chatEmptyState:Ns,chatEmptyStateTitle:Ls,chatEmptyStateSubtitle:As,chatMessageStream:Is,chatMessageGpt:Ps,chatMessageGptMinWidth:Es,chatInput:Rs,chatAnalysisPanel:Ms,chatSettingsSeparator:Gs,loadingLogo:qs,commandsContainer:Os,commandButton:Bs},ne="";function ae(t){var s={"Content-Type":"application/json"};return P&&G==null&&t&&(s.Authorization=`Bearer ${t}`),s}async function ea(t,s){const n=await fetch(`${ne}/ask`,{method:"POST",headers:ae(s),body:JSON.stringify(t)}),c=await n.json();if(n.status>299||!n.ok)throw Error(c.error||"Unknown error");return c}async function Us(t){return await(await fetch(`${ne}/config`,{method:"GET",headers:ae(t)})).json()}async function $s(t,s){return await fetch(`${ne}/chat`,{method:"POST",headers:ae(s),body:JSON.stringify(t)})}function Fe(t){return`${ne}/content/${t}`}var b=(t=>(t.Hybrid="hybrid",t.Vectors="vectors",t.Text="text",t))(b||{}),I=(t=>(t.TextAndImages="textAndImages",t.Images="images",t.Texts="texts",t))(I||{}),N=(t=>(t.Embedding="embedding",t.ImageEmbedding="imageEmbedding",t.Both="both",t))(N||{});const Fs="_answerContainer_1sqax_1",Vs="_answerLogo_1sqax_11",Hs="_answerText_1sqax_15",Ds="_selected_1sqax_34",Qs="_citationLearnMore_1sqax_38",zs="_citation_1sqax_38",Ks="_followupQuestionsList_1sqax_60",Ws="_followupQuestionLearnMore_1sqax_64",Js="_followupQuestion_1sqax_60",Xs="_supContainer_1sqax_83",Ys="_retryButton_1sqax_112",Zs="_loadingdots_1sqax_134",en="_loading_1sqax_134",j={answerContainer:Fs,answerLogo:Vs,answerText:Hs,selected:Ds,citationLearnMore:Qs,citation:zs,followupQuestionsList:Ks,followupQuestionLearnMore:Ws,followupQuestion:Js,supContainer:Xs,retryButton:Ys,loadingdots:Zs,loading:en};function tn(t,s,n){const c=[];let a=t.trim();if(s){let d=a.length;for(let m=a.length-1;m>=0&&a[m]!=="]";m--)if(a[m]==="["){d=m;break}a=a.substring(0,d)}return{answerHtml:a.split(/\[([^\]]+)\]/g).map((d,x)=>{if(x%2===0)return d;{let m;c.indexOf(d)!==-1?m=c.indexOf(d)+1:(c.push(d),m=c.length);const h=Fe(d);return Ct(e.jsx("a",{className:"supContainer",title:d,onClick:()=>n(h),children:e.jsx("sup",{children:m})}))}}).join(""),citations:c}}const Ve=()=>e.jsx(zt,{primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Answer logo"}),Ge=({answer:t,isSelected:s,isStreaming:n,onCitationClicked:c,onThoughtProcessClicked:a,onSupportingContentClicked:u,onFollowupQuestionClicked:r,showFollowupQuestions:d})=>{const x=t.choices[0].context.followup_questions,m=t.choices[0].message.content,h=l.useMemo(()=>tn(m,n,c),[t]),g=Oe.sanitize(h.answerHtml);return e.jsxs(C,{className:`${j.answerContainer} ${s&&j.selected}`,verticalAlign:"space-between",children:[e.jsx(C.Item,{children:e.jsxs(C,{horizontal:!0,horizontalAlign:"space-between",children:[e.jsx(Ve,{}),e.jsxs("div",{children:[e.jsx(Pe,{style:{color:"black"},iconProps:{iconName:"Lightbulb"},title:"Show thought process",ariaLabel:"Show thought process",onClick:()=>a(),disabled:!t.choices[0].context.thoughts?.length}),e.jsx(Pe,{style:{color:"black"},iconProps:{iconName:"ClipboardList"},title:"Show supporting content",ariaLabel:"Show supporting content",onClick:()=>u(),disabled:!t.choices[0].context.data_points})]})]})}),e.jsx(C.Item,{grow:!0,children:e.jsx("div",{className:j.answerText,dangerouslySetInnerHTML:{__html:g}})}),!!h.citations.length&&e.jsx(C.Item,{children:e.jsxs(C,{horizontal:!0,wrap:!0,tokens:{childrenGap:5},children:[e.jsx("span",{className:j.citationLearnMore,children:"Citations:"}),h.citations.map((_,S)=>{const k=Fe(_);return e.jsx("a",{className:j.citation,title:_,onClick:()=>c(k),children:`${++S}. ${_}`},S)})]})}),!!x?.length&&d&&r&&e.jsx(C.Item,{children:e.jsxs(C,{horizontal:!0,wrap:!0,className:`${h.citations.length?j.followupQuestionsList:""}`,tokens:{childrenGap:6},children:[e.jsx("span",{className:j.followupQuestionLearnMore,children:"Follow-up questions:"}),x.map((_,S)=>e.jsx("a",{className:j.followupQuestion,title:_,onClick:()=>r(_),children:`${_}`},S))]})})]})},sn=()=>{const t=vt({from:{opacity:0},to:{opacity:1}});return e.jsx(bt.div,{style:{...t},children:e.jsxs(C,{className:j.answerContainer,verticalAlign:"space-between",children:[e.jsx(Ve,{}),e.jsx(C.Item,{grow:!0,children:e.jsxs("p",{className:j.answerText,children:["Generating answer",e.jsx("span",{className:j.loadingdots})]})})]})})},nn=({error:t,onRetry:s})=>e.jsxs(C,{className:j.answerContainer,verticalAlign:"space-between",children:[e.jsx(Kt,{"aria-hidden":"true","aria-label":"Error icon",primaryFill:"red"}),e.jsx(C.Item,{grow:!0,children:e.jsx("p",{className:j.answerText,children:t})}),e.jsx(Rt,{className:j.retryButton,onClick:s,text:"Retry"})]}),an="_questionInputContainer_hiipw_1",on="_questionInputTextArea_hiipw_12",rn="_questionInputButtonsContainer_hiipw_17",de={questionInputContainer:an,questionInputTextArea:on,questionInputButtonsContainer:rn},cn=({onSend:t,disabled:s,placeholder:n,clearOnSend:c,initQuestion:a})=>{const[u,r]=l.useState("");l.useEffect(()=>{a&&r(a)},[a]);const d=()=>{s||!u.trim()||(t(u),c&&r(""))},x=S=>{S.key==="Enter"&&!S.shiftKey&&(S.preventDefault(),d())},m=(S,k)=>{k?k.length<=1e3&&r(k):r("")},{instance:h}=z(),g=Q&&!me(h),_=s||!u.trim()||g;return g&&(n="Please login to continue..."),e.jsxs(C,{horizontal:!0,className:de.questionInputContainer,children:[e.jsx(pe,{className:de.questionInputTextArea,disabled:g,placeholder:n,multiline:!0,resizable:!1,borderless:!0,value:u,onChange:m,onKeyDown:x}),e.jsx("div",{className:de.questionInputButtonsContainer,children:e.jsx(Mt,{content:"Ask question button",relationship:"label",children:e.jsx(fe,{size:"large",icon:e.jsx(Wt,{primaryFill:"rgba(115, 118, 225, 1)"}),disabled:_,onClick:d})})})]})},ln="_examplesNavList_o3hyg_1",un="_example_o3hyg_1",dn="_exampleText_o3hyg_29",xe={examplesNavList:ln,example:un,exampleText:dn},hn=({text:t,value:s,onClick:n})=>e.jsx("div",{className:xe.example,onClick:()=>n(s),children:e.jsx("p",{className:xe.exampleText,children:t})}),pn=["What is included in my Northwind Health Plus plan that is not in standard?","What happens in a performance review?","What does a Product Manager do?"],mn=["Compare the impact of interest rates and GDP in financial markets.","What is the expected trend for the S&P 500 index over the next five years? Compare it to the past S&P 500 performance","Can you identify any correlation between oil prices and stock market trends?"],gn=({onExampleClicked:t,useGPT4V:s})=>e.jsx("ul",{className:xe.examplesNavList,children:(s?mn:pn).map((n,c)=>e.jsx("li",{children:e.jsx(hn,{text:n,value:n,onClick:t})},c))}),xn="_container_1p3pb_1",_n="_message_1p3pb_9",qe={container:xn,message:_n},se=({message:t})=>e.jsx("div",{className:qe.container,children:e.jsx("div",{className:qe.message,children:t})}),fn="_thoughtProcess_1nmyh_1",Sn="_tList_1nmyh_8",yn="_tListItem_1nmyh_14",Cn="_tStep_1nmyh_40",vn="_tCodeBlock_1nmyh_46",bn="_tProp_1nmyh_50",jn="_citationImg_1nmyh_58",B={thoughtProcess:fn,tList:Sn,tListItem:yn,tStep:Cn,tCodeBlock:vn,tProp:bn,citationImg:jn};function Tn(t){const s=t.split(": "),n=s[0],c=Oe.sanitize(s.slice(1).join(": "));return{title:n,content:c}}const wn="_supportingContentNavList_beb5d_1",kn="_supportingContentItem_beb5d_9",Nn="_supportingContentItemHeader_beb5d_23",Ln="_supportingContentItemText_beb5d_27",An="_supportingContentItemImage_beb5d_32",D={supportingContentNavList:wn,supportingContentItem:kn,supportingContentItemHeader:Nn,supportingContentItemText:Ln,supportingContentItemImage:An},In=({supportingContent:t})=>{const s=Array.isArray(t)?t:t.text,n=Array.isArray(t)?[]:t?.images;return e.jsxs("ul",{className:D.supportingContentNavList,children:[s.map((c,a)=>{const u=Tn(c);return e.jsxs("li",{className:D.supportingContentItem,children:[e.jsx("h4",{className:D.supportingContentItemHeader,children:u.title}),e.jsx("p",{className:D.supportingContentItemText,dangerouslySetInnerHTML:{__html:u.content}})]},a)}),n?.map((c,a)=>e.jsx("img",{className:D.supportingContentItemImage,src:c.url},a))]})};var L=(t=>(t.ThoughtProcessTab="thoughtProcess",t.SupportingContentTab="supportingContent",t.CitationTab="citation",t))(L||{});const Pn=({thoughts:t})=>e.jsx("ul",{className:B.tList,children:t.map((s,n)=>e.jsxs("li",{className:B.tListItem,children:[e.jsx("div",{className:B.tStep,children:s.title}),Array.isArray(s.description)?e.jsx(jt,{language:"json",wrapLongLines:!0,className:B.tCodeBlock,children:JSON.stringify(s.description,null,2)}):e.jsxs(e.Fragment,{children:[e.jsx("div",{children:s.description}),e.jsx(C,{horizontal:!0,tokens:{childrenGap:5},children:s.props&&(Object.keys(s.props)||[]).map(c=>e.jsxs("span",{className:B.tProp,children:[c,": ",JSON.stringify(s.props?.[c])]}))})]})]},n))}),he={disabled:!0,style:{color:"grey"}},En=({answer:t,activeTab:s,activeCitation:n,citationHeight:c,className:a,onActiveTabChanged:u})=>{const r=!t.choices[0].context.thoughts,d=!t.choices[0].context.data_points,x=!n,[m,h]=l.useState(""),g=P?z().instance:void 0,_=async()=>{const S=g?await ge(g):void 0;if(n){const k=n.indexOf("#")?n.split("#")[1]:"",K=await(await fetch(n,{method:"GET",headers:ae(S)})).blob();let W=URL.createObjectURL(K);k&&(W+="#"+k),h(W)}};return l.useEffect(()=>{_()},[]),e.jsxs(Gt,{className:a,selectedKey:s,onLinkClick:S=>S&&u(S.props.itemKey),children:[e.jsx(ue,{itemKey:L.ThoughtProcessTab,headerText:"Thought process",headerButtonProps:r?he:void 0,children:e.jsx(Pn,{thoughts:t.choices[0].context.thoughts||[]})}),e.jsx(ue,{itemKey:L.SupportingContentTab,headerText:"Supporting content",headerButtonProps:d?he:void 0,children:e.jsx(In,{supportingContent:t.choices[0].context.data_points})}),e.jsx(ue,{itemKey:L.CitationTab,headerText:"Citation",headerButtonProps:x?he:void 0,children:n?.endsWith(".png")?e.jsx("img",{src:m,className:B.citationImg}):e.jsx("iframe",{title:"Citation",src:m,width:"100%",height:c})})]})},Rn="_container_cfwv2_1",Mn={container:Rn},Gn=({className:t,onClick:s})=>e.jsx("div",{className:`${Mn.container} ${t??""}`,children:e.jsx(fe,{icon:e.jsx(Jt,{}),onClick:s,children:"Developer settings"})}),qn="_container_cfwv2_1",On={container:qn},Bn=({className:t,disabled:s,onClick:n})=>e.jsx("div",{className:`${On.container} ${t??""}`,children:e.jsx(fe,{icon:e.jsx(Xt,{}),disabled:s,onClick:n,children:"Clear chat"})}),Un="_container_1pzrp_1",$n={container:Un},Fn=[{key:N.Embedding,text:"Text Embeddings"},{key:N.ImageEmbedding,text:"Image Embeddings"},{key:N.Both,text:"Text and Image embeddings"}],Vn=({updateRetrievalMode:t,updateVectorFields:s,showImageOptions:n})=>{const[c,a]=l.useState(b.Hybrid),[u,r]=l.useState(),d=(m,h)=>{a(h?.data||b.Hybrid),t(h?.data||b.Hybrid)},x=(m,h)=>{h&&r(h.key);let g;h?.key==="both"?g=[N.Embedding,N.ImageEmbedding]:g=[h?.key],s(g)};return l.useEffect(()=>{s(n?[N.Embedding,N.ImageEmbedding]:[N.Embedding])},[n]),e.jsxs(C,{className:$n.container,tokens:{childrenGap:10},children:[e.jsx(Ue,{label:"Retrieval mode",options:[{key:"hybrid",text:"Vectors + Text (Hybrid)",selected:c==b.Hybrid,data:b.Hybrid},{key:"vectors",text:"Vectors",selected:c==b.Vectors,data:b.Vectors},{key:"text",text:"Text",selected:c==b.Text,data:b.Text}],required:!0,onChange:d}),n&&[b.Vectors,b.Hybrid].includes(c)&&e.jsx(qt,{options:Fn,onChange:x,selectedKey:u,defaultSelectedKey:N.Both,label:"Vector Fields (Multi-query vector search)"})]})},Hn=()=>{const{instance:t}=z(),s=t.getActiveAccount(),n=r=>typeof r=="string"?r:JSON.stringify(r),a=(r=>Object.keys(r??{}).map(d=>{let x=d;try{const h=new URL(d).pathname.split("/");d=h[h.length-1]}catch{}return{name:d,value:n((r??{})[x])}}))(s?.idTokenClaims??G?.user_claims),u=[Ee({columnId:"name",compare:(r,d)=>r.name.localeCompare(d.name),renderHeaderCell:()=>"Name",renderCell:r=>r.name}),Ee({columnId:"value",compare:(r,d)=>r.value.localeCompare(d.value),renderHeaderCell:()=>"Value",renderCell:r=>r.value})];return e.jsxs("div",{children:[e.jsx(Ot,{children:"ID Token Claims"}),e.jsxs(Bt,{items:a,columns:u,sortable:!0,getRowId:r=>r.name,children:[e.jsx(Ut,{children:e.jsx(Re,{children:({renderHeaderCell:r})=>e.jsx($t,{children:r()})})}),e.jsx(Ft,{children:({item:r,rowId:d})=>e.jsx(Re,{children:({renderCell:x})=>e.jsx(Vt,{children:x(r)})},d)})]})]})},Dn="_container_1pzrp_1",Qn={container:Dn},zn=({updateGPT4VInputs:t,updateUseGPT4V:s,isUseGPT4V:n,gpt4vInputs:c})=>{const[a,u]=l.useState(n),[r,d]=l.useState(c||I.TextAndImages),x=(h,g)=>{s(!!g),u(!!g)},m=(h,g)=>{if(g){const _=g.key;t(_||I.TextAndImages),_&&d(_)}};return l.useEffect(()=>{a&&t(I.TextAndImages)},[a]),e.jsxs(C,{className:Qn.container,tokens:{childrenGap:10},children:[e.jsx(M,{checked:a,label:"Use GPT-4 Turbo with Vision",onChange:x}),a&&e.jsx(Ue,{selectedKey:r,label:"GPT-4 Turbo with Vision Inputs",options:[{key:I.TextAndImages,text:"Images and text from index"},{text:"Images only",key:I.Images},{text:"Text only",key:I.Texts}],required:!0,onChange:m})]})},Kn=()=>{const[t,s]=l.useState(!1),[n,c]=l.useState(""),[a,u]=l.useState(.3),[r,d]=l.useState(3),[x,m]=l.useState(b.Hybrid),[h,g]=l.useState(!0),[_,S]=l.useState(!0),[k,Se]=l.useState(!1),[K,W]=l.useState(""),[J,He]=l.useState(!1),[De,Qe]=l.useState([N.Embedding]),[ye,ze]=l.useState(!1),[Ce,Ke]=l.useState(!1),[ve,We]=l.useState(I.TextAndImages),[X,Je]=l.useState(!1),E=l.useRef(""),oe=l.useRef(null),[Y,Z]=l.useState(!1),[be,re]=l.useState(!1),[ee,ie]=l.useState(),[je,ce]=l.useState(),[$,q]=l.useState(void 0),[F,Te]=l.useState(0),[T,te]=l.useState([]),[we,ke]=l.useState([]),[Ne,Xe]=l.useState(!1),[Ye,Ze]=l.useState(!1),[et,tt]=l.useState(!1),st=async()=>{const i=O?await ge(O):void 0;Us(i).then(o=>{Xe(o.showGPT4VOptions),g(o.showSemanticRankerOption),Ze(o.showSemanticRankerOption),tt(o.showVectorOption),o.showVectorOption||m(b.Text)})},nt=async(i,o,w,le)=>{let A="",f={};const xt=y=>new Promise(_t=>{setTimeout(()=>{A+=y;const ft={...f,choices:[{...f.choices[0],message:{content:A,role:f.choices[0].message.role}}]};ke([...o,[i,ft]]),_t(null)},33)});try{re(!0);for await(const y of Tt(le))if(y.choices&&y.choices[0].context&&y.choices[0].context.data_points)y.choices[0].message=y.choices[0].delta,f=y;else if(y.choices&&y.choices[0].delta.content)Z(!1),await xt(y.choices[0].delta.content);else if(y.choices&&y.choices[0].context)f.choices[0].context={...f.choices[0].context,...y.choices[0].context};else if(y.error)throw Error(y.error)}finally{re(!1)}return{...f,choices:[{...f.choices[0],message:{content:A,role:f.choices[0].message.role}}]}},O=P?z().instance:void 0,V=async i=>{E.current=i,ee&&ie(void 0),Z(!0),ce(void 0),q(void 0);const o=O?await ge(O):void 0;try{const le={messages:[...T.flatMap(f=>[{content:f[0],role:"user"},{content:f[1].choices[0].message.content,role:"assistant"}]),{content:i,role:"user"}],stream:_,context:{overrides:{prompt_template:n.length===0?void 0:n,exclude_category:K.length===0?void 0:K,top:r,temperature:a,retrieval_mode:x,semantic_ranker:h,semantic_captions:k,suggest_followup_questions:J,use_oid_security_filter:ye,use_groups_security_filter:Ce,vector_fields:De,use_gpt4v:X,gpt4v_input:ve}},session_state:T.length?T[T.length-1][1].choices[0].session_state:null},A=await $s(le,o);if(!A.body)throw Error("No response body");if(_){const f=await nt(i,T,te,A.body);te([...T,[i,f]])}else{const f=await A.json();if(A.status>299||!A.ok)throw Error(f.error||"Unknown error");te([...T,[i,f]])}}catch(w){ie(w)}finally{Z(!1)}},at=()=>{E.current="",ee&&ie(void 0),ce(void 0),q(void 0),te([]),ke([]),Z(!1),re(!1)};l.useEffect(()=>oe.current?.scrollIntoView({behavior:"smooth"}),[Y]),l.useEffect(()=>oe.current?.scrollIntoView({behavior:"auto"}),[we]),l.useEffect(()=>{st()},[]);const ot=(i,o)=>{c(o||"")},rt=(i,o,w)=>{u(i)},it=(i,o)=>{d(parseInt(o||"3"))},ct=(i,o)=>{g(!!o)},lt=(i,o)=>{Se(!!o)},ut=(i,o)=>{S(!!o)},dt=(i,o)=>{W(o||"")},ht=(i,o)=>{He(!!o)},pt=(i,o)=>{ze(!!o)},mt=(i,o)=>{Ke(!!o)},gt=i=>{V(i)},Le=(i,o)=>{je===i&&$===L.CitationTab&&F===o?q(void 0):(ce(i),q(L.CitationTab)),Te(o)},H=(i,o)=>{q($===i&&F===o?void 0:i),Te(o)};return e.jsxs("div",{className:p.container,children:[e.jsxs("div",{className:p.commandsContainer,children:[e.jsx(Bn,{className:p.commandButton,onClick:at,disabled:!E.current||Y}),e.jsx(Gn,{className:p.commandButton,onClick:()=>s(!t)})]}),e.jsxs("div",{className:p.chatRoot,children:[e.jsxs("div",{className:p.chatContainer,children:[E.current?e.jsxs("div",{className:p.chatMessageStream,children:[be&&we.map((i,o)=>e.jsxs("div",{children:[e.jsx(se,{message:i[0]}),e.jsx("div",{className:p.chatMessageGpt,children:e.jsx(Ge,{isStreaming:!0,answer:i[1],isSelected:!1,onCitationClicked:w=>Le(w,o),onThoughtProcessClicked:()=>H(L.ThoughtProcessTab,o),onSupportingContentClicked:()=>H(L.SupportingContentTab,o),onFollowupQuestionClicked:w=>V(w),showFollowupQuestions:J&&T.length-1===o},o)})]},o)),!be&&T.map((i,o)=>e.jsxs("div",{children:[e.jsx(se,{message:i[0]}),e.jsx("div",{className:p.chatMessageGpt,children:e.jsx(Ge,{isStreaming:!1,answer:i[1],isSelected:F===o&&$!==void 0,onCitationClicked:w=>Le(w,o),onThoughtProcessClicked:()=>H(L.ThoughtProcessTab,o),onSupportingContentClicked:()=>H(L.SupportingContentTab,o),onFollowupQuestionClicked:w=>V(w),showFollowupQuestions:J&&T.length-1===o},o)})]},o)),Y&&e.jsxs(e.Fragment,{children:[e.jsx(se,{message:E.current}),e.jsx("div",{className:p.chatMessageGptMinWidth,children:e.jsx(sn,{})})]}),ee?e.jsxs(e.Fragment,{children:[e.jsx(se,{message:E.current}),e.jsx("div",{className:p.chatMessageGptMinWidth,children:e.jsx(nn,{error:ee.toString(),onRetry:()=>V(E.current)})})]}):null,e.jsx("div",{ref:oe})]}):e.jsxs("div",{className:p.chatEmptyState,children:[e.jsx(Yt,{fontSize:"120px",primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Chat logo"}),e.jsx("h1",{className:p.chatEmptyStateTitle,children:"Chat with your data"}),e.jsx("h2",{className:p.chatEmptyStateSubtitle,children:"Ask anything or try an example"}),e.jsx(gn,{onExampleClicked:gt,useGPT4V:X})]}),e.jsx("div",{className:p.chatInput,children:e.jsx(cn,{clearOnSend:!0,placeholder:"Type a new question (e.g. does my plan cover annual eye exams?)",disabled:Y,onSend:i=>V(i)})})]}),T.length>0&&$&&e.jsx(En,{className:p.chatAnalysisPanel,activeCitation:je,onActiveTabChanged:i=>H(i,F),citationHeight:"810px",answer:T[F][1],activeTab:$}),e.jsxs(Ht,{headerText:"Configure answer generation",isOpen:t,isBlocking:!1,onDismiss:()=>s(!1),closeButtonAriaLabel:"Close",onRenderFooterContent:()=>e.jsx(Be,{onClick:()=>s(!1),children:"Close"}),isFooterAtBottom:!0,children:[e.jsx(pe,{className:p.chatSettingsSeparator,defaultValue:n,label:"Override prompt template",multiline:!0,autoAdjustHeight:!0,onChange:ot}),e.jsx(Dt,{className:p.chatSettingsSeparator,label:"Temperature",min:0,max:1,step:.1,defaultValue:a,onChange:rt,showValue:!0,snapToStep:!0}),e.jsx(Qt,{className:p.chatSettingsSeparator,label:"Retrieve this many search results:",min:1,max:50,defaultValue:r.toString(),onChange:it}),e.jsx(pe,{className:p.chatSettingsSeparator,label:"Exclude category",onChange:dt}),Ye&&e.jsx(M,{className:p.chatSettingsSeparator,checked:h,label:"Use semantic ranker for retrieval",onChange:ct}),e.jsx(M,{className:p.chatSettingsSeparator,checked:k,label:"Use query-contextual summaries instead of whole documents",onChange:lt,disabled:!h}),e.jsx(M,{className:p.chatSettingsSeparator,checked:J,label:"Suggest follow-up questions",onChange:ht}),Ne&&e.jsx(zn,{gpt4vInputs:ve,isUseGPT4V:X,updateUseGPT4V:i=>{Je(i)},updateGPT4VInputs:i=>We(i)}),et&&e.jsx(Vn,{showImageOptions:X&&Ne,updateVectorFields:i=>Qe(i),updateRetrievalMode:i=>m(i)}),P&&e.jsx(M,{className:p.chatSettingsSeparator,checked:ye||Q,label:"Use oid security filter",disabled:!me(O)||Q,onChange:pt}),P&&e.jsx(M,{className:p.chatSettingsSeparator,checked:Ce||Q,label:"Use groups security filter",disabled:!me(O)||Q,onChange:mt}),e.jsx(M,{className:p.chatSettingsSeparator,checked:_,label:"Stream chat completion responses",onChange:ut}),P&&e.jsx(Hn,{})]})]})]})};var _e;if(P){var R=new wt(ns);!R.getActiveAccount()&&R.getAllAccounts().length>0&&R.setActiveAccount(R.getActiveAccount()),R.addEventCallback(t=>{if(t.eventType===kt.LOGIN_SUCCESS&&t.payload){const s=t.payload;R.setActiveAccount(s)}}),_e=e.jsx(Et,{instance:R,children:e.jsx(Me,{})})}else _e=e.jsx(Me,{});Nt();const Wn=Lt([{path:"/",element:_e,children:[{index:!0,element:e.jsx(Kn,{})},{path:"qa",lazy:()=>Ie(()=>import("./Ask-3c4f5122.js"),["assets/Ask-3c4f5122.js","assets/vendor-3b0eb66e.js","assets/fluentui-react-cc049b91.js","assets/fluentui-icons-cc979dd7.js","assets/Ask-4461589d.css"])},{path:"*",lazy:()=>Ie(()=>import("./NoPage-53567df7.js"),["assets/NoPage-53567df7.js","assets/vendor-3b0eb66e.js"])}]}]);At.createRoot(document.getElementById("root")).render(e.jsx(It.StrictMode,{children:e.jsx(Pt,{router:Wn})}));export{Ge as A,gn as E,I as G,cn as Q,b as R,Gn as S,Hn as T,N as V,L as a,nn as b,En as c,zn as d,Vn as e,Us as f,ge as g,ea as h,me as i,Q as r,P as u};
//# sourceMappingURL=index-cf2ac81c.js.map
